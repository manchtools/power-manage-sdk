syntax = "proto3";

package powermanage.v1;

option go_package = "github.com/yourorg/power-manage/sdk/gen/go/powermanage/v1;powermanagev1";

import "google/protobuf/timestamp.proto";

// Unique identifier for an action instance
message ActionId {
  // @gotags: validate:"required,ulid"
  string value = 1;
}

// Unique identifier for a device/agent
message DeviceId {
  // @gotags: validate:"required,ulid"
  string value = 1;
}

// Execution status for any action
enum ExecutionStatus {
  EXECUTION_STATUS_UNSPECIFIED = 0;
  EXECUTION_STATUS_PENDING = 1;
  EXECUTION_STATUS_RUNNING = 2;
  EXECUTION_STATUS_SUCCESS = 3;
  EXECUTION_STATUS_FAILED = 4;
  EXECUTION_STATUS_SKIPPED = 5;
  EXECUTION_STATUS_CANCELLED = 6;
  EXECUTION_STATUS_TIMEOUT = 7;
}

// Desired state for stateful actions
enum DesiredState {
  DESIRED_STATE_UNSPECIFIED = 0;
  DESIRED_STATE_PRESENT = 1;   // Install/create/enable
  DESIRED_STATE_ABSENT = 2;    // Remove/delete/disable
  DESIRED_STATE_LATEST = 3;    // Ensure latest version
}

// Rollback policy for actions
enum RollbackPolicy {
  ROLLBACK_POLICY_ON_FAILURE = 0;  // Rollback only on failure
  ROLLBACK_POLICY_NONE = 1;        // Never rollback
}

// Output from command execution
message CommandOutput {
  // @gotags: validate:"omitempty"
  int32 exit_code = 1;
  // @gotags: validate:"omitempty,max=1048576"
  string stdout = 2;
  // @gotags: validate:"omitempty,max=1048576"
  string stderr = 3;
  // @gotags: validate:"omitempty,gte=0"
  int64 duration_ms = 4;
}
